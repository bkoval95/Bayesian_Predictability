---
title: "Figures and Tables"
author: "Borys"
date: "2023-10-31"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


# Please specify your path to the folder
path      <- substr(getwd(), 1, nchar(getwd())-4)

# Source packages and functions
source(paste0(path, "code/functions_IN.R"))

```

## Table 1

```{r table_1_prepare, warning=FALSE, include=FALSE}
# Save the results
results <- fun.combine_results(folder = "v4")

results.phi <- results$phi_all_methods %>% 
  mutate(Prior_type  = case_when(Method %in% c("OLS", "RBE") ~ "None",
                                 TRUE ~ Prior_type)) %>% 
  mutate(SD.dgp_1    = 100 * sqrt(Var.dgp_1 / 1000),
         RMSE.dgp_1  = 100 * sqrt(MSE.dgp_1 / 1000),
         SD.dgp_2    = 100 * sqrt(Var.dgp_2 / 1000),
         RMSE.dgp_2  = 100 * sqrt(MSE.dgp_2 / 1000))


results.phi.1 <- results.phi %>% 
  filter(Prior_type %in% c("None", "BAY_5_8")) %>% 
  select(Method, 
         Bias.dgp_1,
         SD.dgp_1,
         MAE.dgp_1,
         RMSE.dgp_1) %>% 
  mutate(across(is.numeric, ~round(.x, 2))) %>% 
  set_names(c("Method", "Bias.dgp_0", "SD.dgp_0", "MAE.dgp_0", "RMSE.dgp_0"))

results.phi.2 <- results.phi %>% 
  filter(Prior_type %in% c("None", "BAY_5_8")) %>% 
  select(Method, 
         Bias.dgp_2,
         SD.dgp_2,
         MAE.dgp_2,
         RMSE.dgp_2) %>% 
  mutate(across(is.numeric, ~round(.x, 2))) %>% 
  set_names(c("Method", "Bias.dgp_1", "SD.dgp_1", "MAE.dgp_1", "RMSE.dgp_1"))


```

Measures of the estimation quality for $\widehat{\phi}^{\bullet}$ (multiplied by 100): Bias $B(\widehat{\phi}^{\bullet}, \phi$), Sample standard deviation of the point estimates $\sigma(\widehat{\phi}^{\bullet})$, MAE($\widehat{\phi}^{\bullet}, \phi$), RMSE($\widehat{\phi}^{\bullet}, \phi$). Three estimation methods: OLS, RBE and BAY. *DGP 0* sets $\beta = 0$, whereas *DGP 1* fixes $\beta = 0.1$.

```{r table_1_show, results='asis'}
kable(results.phi.1, digits = 2)
kable(results.phi.2, digits = 2)
```


```{r table_1_delete, warning=FALSE, include=FALSE}
#rm(list = ls())

# knitr::knit_exit()

```


## Table 2

```{r table_2_prepare, warning=FALSE, include=FALSE}
# Save the results
results             <- fun.combine_results(folder = "v4")
results.fixed_dgp_0 <- fun.combine_results_v2(folder = "v8/fixed/bR_1/dgp_1")
results.fixed_dgp_1 <- fun.combine_results_v2(folder = "v8/fixed/bR_1/dgp_2")


results.beta <- results$beta_all_methods %>% 
  mutate(Prior_type  = case_when(Method %in% c("OLS", "RBE") ~ "None",
                                 TRUE ~ Prior_type)) %>% 
  select(-Prior_phi) %>% 
  mutate(SD.dgp_1    = 100 * sqrt(Var.dgp_1 / 1000),
         RMSE.dgp_1  = 100 * sqrt(MSE.dgp_1 / 1000),
         SD.dgp_2    = 100 * sqrt(Var.dgp_2 / 1000),
         RMSE.dgp_2  = 100 * sqrt(MSE.dgp_2 / 1000))

results.beta.1.prior <- results.beta %>% 
  filter(Prior_type %in% c("None", "BAY_5_8")) %>% 
  select(Method, 
         Bias.dgp_1,
         SD.dgp_1,
         MAE.dgp_1,
         RMSE.dgp_1,
         SAV_med.dgp_1) %>% 
  mutate(across(is.numeric, ~round(.x, 2)))

results.beta.1.fixed <- results.fixed_dgp_0$beta_all_methods %>% 
  filter(Method == "BAY") %>% 
  mutate(SD.dgp_1    = 100 * sqrt(Var / 1000),
         RMSE.dgp_1  = 100 * sqrt(MSE / 1000)) %>% 
  select(Method, 
         Bias,
         SD.dgp_1,
         MAE,
         RMSE.dgp_1,
         SAV_med)

results.beta.2.prior <- results.beta %>% 
  filter(Prior_type %in% c("None", "BAY_5_8")) %>% 
  select(Method, 
         Bias.dgp_2,
         SD.dgp_2,
         MAE.dgp_2,
         RMSE.dgp_2,
         SAV_med.dgp_2) %>% 
  mutate(across(is.numeric, ~round(.x, 2)))

results.beta.2.fixed <- results.fixed_dgp_1$beta_all_methods %>% 
  filter(Method == "BAY") %>% 
  mutate(SD.dgp_2    = 100 * sqrt(Var / 1000),
         RMSE.dgp_2  = 100 * sqrt(MSE / 1000)) %>% 
  select(Method, 
         Bias,
         SD.dgp_2,
         MAE,
         RMSE.dgp_2,
         SAV_med)

# Change names for bind_rows
colnames(results.beta.1.fixed) <- colnames(results.beta.1.prior)
colnames(results.beta.2.fixed) <- colnames(results.beta.2.prior)


tbl_final_1 <- bind_rows(results.beta.1.prior,
                         results.beta.1.fixed) %>% 
  set_names(c("Method", "Bias.dgp_0", "SD.dgp_0", "MAE.dgp_0", "RMSE.dgp_0", "SAV_med_dgp_0"))

tbl_final_2 <- bind_rows(results.beta.2.prior,
                         results.beta.2.fixed) %>% 
  set_names(c("Method", "Bias.dgp_1", "SD.dgp_1", "MAE.dgp_1", "RMSE.dgp_1", "SAV_med_dgp_1"))

```

Measures of the estimation quality for $\widehat{\beta}^{\bullet}$ (multiplied by 100): Bias $B(\widehat{\beta}^{\bullet}, \beta$), Sample standard deviation of the point estimates $\sigma(\widehat{\beta}^{\bullet})$, MAE($\widehat{\beta}^{\bullet}, \beta$), RMSE($\widehat{\beta}^{\bullet}, \beta$), estimated False Positive ($\widehat{FP}$) and estimated False Negative rates ($\widehat{FN}$). Three estimation methods: OLS, RBE and BAY. *DGP 0* sets $\beta = 0$, whereas *DGP 1* fixes $\beta = 0.1$.

```{r table_2_show, results='asis'}

kable(tbl_final_1, digits = 2)
kable(tbl_final_2, digits = 2)

```


```{r table_2_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Table 3(4)

```{r table_3_prepare, warning=FALSE, include=FALSE}

# Take necessary names
names_files <- list.files(paste0(path, "data/2.real_data/res/"))

# Object to save
res_all <- list()

# Save
for(i in 1:length(names_files)){
  
  res_all[[i]] <- read_rds(paste0(path, "data/2.real_data/res/", names_files[i]))
  
  print(i)
  
}

res.beta <- lapply(res_all,
                   function(x) as_tibble(fun.posterior_results_beta_table(data_in  = x,  
                                                                          prior_in = rep("r2", 2), alpha_in = 0.05)))

# Summary
summary.beta <- lapply(1:length(names_files), function(x) fun.summary_beta(list(res_all[[x]])))

# Prepare results
for(i in 1:length(names_files)){
  
  if(i == 1){
    res.beta.table.all <- summary.beta[[i]] %>% 
      inner_join(res.beta[[i]], by = "Method") %>% 
      select(Method, Psi ,Phi, Mean, SD, K_med) %>% 
      mutate(across(Psi:K_med, ~round(., 3))) %>% 
      mutate(Method = gsub("_", " ", Method, fixed = TRUE)) %>% 
      mutate(Var = str_split(names_files[i], "[.]")[[1]][3])
  }else{
    
    res.beta.table <- summary.beta[[i]] %>% 
      inner_join(res.beta[[i]], by = "Method") %>% 
      select(Method, Psi ,Phi, Mean, SD, K_med) %>% 
      mutate(across(Psi:K_med, ~round(., 3))) %>% 
      mutate(Method = gsub("_", " ", Method, fixed = TRUE)) %>% 
      mutate(Var = str_split(names_files[i], "[.]")[[1]][3])
    
    res.beta.table.all <- res.beta.table.all %>% 
      bind_rows(res.beta.table)
    
    
  }
  
}

# Vars order
order_in <- c("dp_crsp_1", "dp_crsp_2", "bm", "ep_sp", "dg_sp", "dfy", "tms")

# Final changes
res.beta.table.all <- res.beta.table.all %>% 
  mutate(Method = case_when(Method == "Prior 1" ~ "BAY",
                            TRUE ~ Method)) %>% 
  mutate(Var =  factor(Var, levels = order_in)) %>%
  arrange(Var)   

```


Results for the prediction variable log-price-dividend ratio DP: Parameter estimates: $\widehat{\psi}^{\bullet}$, $\widehat{\phi}^{\bullet}$ and 
 $\widehat{\beta}^{\bullet}$, the standard error $SE(\widehat{\beta}^{\bullet})$  (the standard deviation of ${\beta}^{(m)}$ after burn-in and thinning), Bayes Factor estimate $\widehat{BF}_{01}$ for the Bayesian estimation, $p$-values for frequentist estimation.

```{r table_3_show, results='asis'}

kable(res.beta.table.all[1:6,], digits = 3)

```


Results: Parameter estimate
 $\widehat{\psi}^{\bullet}$, Parameter estimate
 $\widehat{\phi}^{\bullet}$, Parameter estimate
 $\widehat{\beta}^{\bullet}$, the standard error $SE(\widehat{\beta}^{\bullet})$  (the standard deviation of ${\beta}^{(m)}$ after burn-in and thinning), Bayes Factor estimate $\widehat{BF}_{01}$ for the Bayesian estimation, $p$-values for the frequentist estimation.

```{r table_4_show, results='asis'}
kable(res.beta.table.all[-(1:6),], digits = 3)
```

```{r table_3_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```



## Table 5

Out-of-sample $R^{2 \bullet}_{OOS}$(in percent) for Bayesian, OLS and RBE 
estimation based on the *expanding* and *rolling* window approaches with a window size of 40 years that starts in 1966 and ends in 2020. Log Dividend-Price Ratio (DP). Book-to-Market Ratio (BM). Log Earnings-Price Ratio (EP). Log Dividend-Growth (DG). Default Yield Spread (DFY). Term Spread (TMS).

```{r table_5_prepare, warning=FALSE, include=FALSE}

# Names
names_in <- c("dp.crsp", "ep.sp", "b.m", "dg.sp", "dfy","tms")

# Empty tables
tbl.rol <- matrix(NA_real_, nrow = length(names_in),  ncol = 3)
tbl.exp <- matrix(NA_real_, nrow = length(names_in),  ncol = 3)

# Save the results
for(i in 1:length(names_in)){
  
  tbl.errors.rol <- read_rds(paste0(path, "/data/2.real_data/oos/",names_in[i],"/tbl.errors.rol.rds"))
  
  tbl.errors.exp <- read_rds(paste0(path, "/data/2.real_data/oos/",names_in[i],"/tbl.errors.exp.rds"))
  
  # OOS R2
  tbl.rol[i,] <- 1 - colMeans(tbl.errors.rol[,3:5]^2) / mean(tbl.errors.rol[,6]^2)
  tbl.exp[i,] <- 1 - colMeans(tbl.errors.exp[,3:5]^2) / mean(tbl.errors.exp[,6]^2)
  
}

# Prepare for the output
res.exp <- as_tibble(tbl.exp) %>% 
  mutate(across(V1:V3, ~round(100 * ., 3))) %>% 
  mutate(name = c("dp", "ep", "bm", "dg", "dfy", "tms"), .before = V1) %>% 
  set_names(c("Variable", "BAY", "OLS", "RBE"))

res.rol <- as_tibble(tbl.rol) %>% 
  mutate(across(V1:V3, ~round(100 * ., 3))) %>% 
  mutate(name = c("dp", "ep", "bm", "dg", "dfy", "tms"), .before = V1) %>% 
  set_names(c("Variable", "BAY", "OLS", "RBE"))

```

```{r table_5_rol_show, results='asis'}

kable(res.rol, digits = 3)

```

```{r table_5_exp_show, results='asis'}

kable(res.exp, digits = 3)

```


```{r table_5_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Table 6

```{r table_6_prepare, warning=FALSE, include=FALSE}

# We use another notation for multiple DGPs

# beta == 0      - DGP1
# beta == 0.1    - DGP2
# beta == 0.05   - DGP3
# beta == 0.2    - DGP4
# beta == 0.025  - DGP5
# beta == 0.075  - DGP6

results.prior.1 <- fun.combine_results_v2(folder = "v4/dgp_1")
results.prior.2 <- fun.combine_results_v2(folder = "v4/dgp_2")
results.prior.3 <- fun.combine_results_v2(folder = "v8/prior/bR_1/dgp_3")
results.prior.4 <- fun.combine_results_v2(folder = "v8/prior/bR_1/dgp_4")
results.prior.5 <- fun.combine_results_v2(folder = "v8/prior/bR_1/dgp_5")
results.prior.6 <- fun.combine_results_v2(folder = "v8/prior/bR_1/dgp_6")

results.fixed.1 <- fun.combine_results_v2(folder = "v8/fixed/bR_1/dgp_1")
results.fixed.2 <- fun.combine_results_v2(folder = "v8/fixed/bR_1/dgp_2")
results.fixed.3 <- fun.combine_results_v2(folder = "v8/fixed/bR_1/dgp_3")
results.fixed.4 <- fun.combine_results_v2(folder = "v8/fixed/bR_1/dgp_4")
results.fixed.5 <- fun.combine_results_v2(folder = "v8/fixed/bR_1/dgp_5")
results.fixed.6 <- fun.combine_results_v2(folder = "v8/fixed/bR_1/dgp_6")

results.fixed.1$beta_all_methods$DGP <- "1"
results.fixed.2$beta_all_methods$DGP <- "2"
results.fixed.3$beta_all_methods$DGP <- "3"
results.fixed.4$beta_all_methods$DGP <- "4"
results.fixed.5$beta_all_methods$DGP <- "5"
results.fixed.6$beta_all_methods$DGP <- "6"

results.prior.1$beta_all_methods$DGP <- "1"
results.prior.2$beta_all_methods$DGP <- "2"
results.prior.3$beta_all_methods$DGP <- "3"
results.prior.4$beta_all_methods$DGP <- "4"
results.prior.5$beta_all_methods$DGP <- "5"
results.prior.6$beta_all_methods$DGP <- "6"

results.fixed.1 <- results.fixed.1$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.2 <- results.fixed.2$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.3 <- results.fixed.3$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.4 <- results.fixed.4$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.5 <- results.fixed.5$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.6 <- results.fixed.6$beta_all_methods %>% 
  filter(Method == "BAY")


results.beta.1 <- results.prior.1$beta_all_methods %>%
  filter(Prior_type %in% c("BAY_5_8") | Method %in% c("OLS", "RBE")) %>% 
  rbind(results.fixed.1) %>% 
  relocate(DGP, .before = everything()) %>% 
  select(-Prior_phi) %>% 
  mutate(SD   = 100 * sqrt(Var / 1000),
         RMSE = 100 * sqrt(MSE / 1000)) %>% 
  select(Method, 
         Bias,
         SD,
         MAE,
         RMSE,
         SAV_med) %>% 
  mutate(across(is.numeric, ~round(.x, 2)))


results.beta.rest <- results.prior.5$beta_all_methods %>%
  rbind(results.fixed.5) %>% 
  
  rbind(results.prior.3$beta_all_methods) %>%
  rbind(results.fixed.3) %>% 
  
  rbind(results.prior.6$beta_all_methods) %>%
  rbind(results.fixed.6) %>% 
  
  rbind(results.prior.2$beta_all_methods %>% 
          filter(Prior_type %in% c("BAY_5_8") | Method %in% c("OLS", "RBE"))
        ) %>%
  rbind(results.fixed.2) %>% 

  rbind(results.prior.4$beta_all_methods) %>%
  rbind(results.fixed.4) %>% 
  
  relocate(DGP, .before = everything()) %>% 
  select(-Prior_phi) %>% 
  mutate(SD   = 100 * sqrt(Var / 1000),
         RMSE = 100 * sqrt(MSE / 1000)) %>% 
  select(Method, 
         Bias,
         SD,
         MAE,
         RMSE,
         SAV_med) %>% 
  mutate(across(is.numeric, ~round(.x, 2)))


Vars_in <- c(rep("0", 5),
             rep("0.025", 5),
             rep("0.05", 5),
             rep("0.075", 5),
             rep("0.1", 5),
             rep("0.2", 5)
             )

results.final <- bind_rows(results.beta.1, results.beta.rest) %>% 
  mutate(beta = Vars_in)

```


Measures of the estimation quality for $\widehat{\beta}^{\bullet}$ (multiplied by 100): Bias $B(\widehat{\beta}^{\bullet}, \beta$), Sample standard deviation of the point estimates $\sigma(\widehat{\beta}^{\bullet})$, MAE($\widehat{\beta}^{\bullet}, \beta$), RMSE($\widehat{\beta}^{\bullet}, \beta$), estimated False Positive ($\widehat{FP}$) and estimated False Negative rates ($\widehat{FN}$). Three estimation methods: OLS, RBE and BAY. We have 6  *DGPs*  where $\beta \in \{0, 0.025, 0.05, 0.075, 0.1, 0.2\}$ and $b_0^R = 1$.

```{r table_6_show, results='asis'}

kable(results.final, digits = 2)

```


```{r table_6_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Table 7

```{r table_7_prepare, warning=FALSE, include=FALSE}

# We do not report OLS and RBE since they are the same as in Table 6

# We use another notation for multiple DGPs

# beta == 0      - DGP1
# beta == 0.1    - DGP2
# beta == 0.05   - DGP3
# beta == 0.2    - DGP4
# beta == 0.025  - DGP5
# beta == 0.075  - DGP6

results.prior.1 <- fun.combine_results_v2(folder = "v4/dgp_1")
results.prior.2 <- fun.combine_results_v2(folder = "v4/dgp_2")
results.prior.3 <- fun.combine_results_v2(folder = "v8/prior/bR_0.5/dgp_3")
results.prior.4 <- fun.combine_results_v2(folder = "v8/prior/bR_0.5/dgp_4")
results.prior.5 <- fun.combine_results_v2(folder = "v8/prior/bR_0.5/dgp_5")
results.prior.6 <- fun.combine_results_v2(folder = "v8/prior/bR_0.5/dgp_6")

results.fixed.1 <- fun.combine_results_v2(folder = "v8/fixed/bR_0.5/dgp_1")
results.fixed.2 <- fun.combine_results_v2(folder = "v8/fixed/bR_0.5/dgp_2")
results.fixed.3 <- fun.combine_results_v2(folder = "v8/fixed/bR_0.5/dgp_3")
results.fixed.4 <- fun.combine_results_v2(folder = "v8/fixed/bR_0.5/dgp_4")
results.fixed.5 <- fun.combine_results_v2(folder = "v8/fixed/bR_0.5/dgp_5")
results.fixed.6 <- fun.combine_results_v2(folder = "v8/fixed/bR_0.5/dgp_6")

results.fixed.1$beta_all_methods$DGP <- "1"
results.fixed.2$beta_all_methods$DGP <- "2"
results.fixed.3$beta_all_methods$DGP <- "3"
results.fixed.4$beta_all_methods$DGP <- "4"
results.fixed.5$beta_all_methods$DGP <- "5"
results.fixed.6$beta_all_methods$DGP <- "6"

results.prior.1$beta_all_methods$DGP <- "1"
results.prior.2$beta_all_methods$DGP <- "2"
results.prior.3$beta_all_methods$DGP <- "3"
results.prior.4$beta_all_methods$DGP <- "4"
results.prior.5$beta_all_methods$DGP <- "5"
results.prior.6$beta_all_methods$DGP <- "6"

results.fixed.1 <- results.fixed.1$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.2 <- results.fixed.2$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.3 <- results.fixed.3$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.4 <- results.fixed.4$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.5 <- results.fixed.5$beta_all_methods %>% 
  filter(Method == "BAY")
results.fixed.6 <- results.fixed.6$beta_all_methods %>% 
  filter(Method == "BAY")


results.beta.1 <- results.prior.1$beta_all_methods %>%
  filter(Prior_type %in% c("BAY_5_2")) %>% 
  rbind(results.fixed.1) %>% 
  relocate(DGP, .before = everything()) %>% 
  select(-Prior_phi) %>% 
  mutate(SD   = 100 * sqrt(Var / 1000),
         RMSE = 100 * sqrt(MSE / 1000)) %>% 
  select(Method, 
         Bias,
         SD,
         MAE,
         RMSE,
         SAV_med) %>% 
  mutate(across(is.numeric, ~round(.x, 2)))


results.beta.rest <- results.prior.5$beta_all_methods %>%
  rbind(results.fixed.5) %>% 
  
  rbind(results.prior.3$beta_all_methods) %>%
  rbind(results.fixed.3) %>% 
  
  rbind(results.prior.6$beta_all_methods) %>%
  rbind(results.fixed.6) %>% 
  
  rbind(results.prior.2$beta_all_methods %>% 
          filter(Prior_type %in% c("BAY_5_2"))
  ) %>%
  rbind(results.fixed.2) %>% 
  
  rbind(results.prior.4$beta_all_methods) %>%
  rbind(results.fixed.4) %>% 
  
  filter(Method == "BAY") %>% 
  relocate(DGP, .before = everything()) %>% 
  select(-Prior_phi) %>% 
  mutate(SD   = 100 * sqrt(Var / 1000),
         RMSE = 100 * sqrt(MSE / 1000)) %>% 
  select(Method, 
         Bias,
         SD,
         MAE,
         RMSE,
         SAV_med) %>% 
  mutate(across(is.numeric, ~round(.x, 2)))


Vars_in <- c(rep("0", 3),
             rep("0.025", 3),
             rep("0.05", 3),
             rep("0.075", 3),
             rep("0.1", 3),
             rep("0.2", 3)
)

results.final <- bind_rows(results.beta.1, results.beta.rest) %>% 
  mutate(beta = Vars_in)

```

Measures of the estimation quality for $\widehat{\beta}^{\bullet}$ (multiplied by 100): Bias $B(\widehat{\beta}^{\bullet}, \beta$), Sample standard deviation of the point estimates $\sigma(\widehat{\beta}^{\bullet})$, MAE($\widehat{\beta}^{\bullet}, \beta$), RMSE($\widehat{\beta}^{\bullet}, \beta$), estimated False Positive ($\widehat{FP}$) and estimated False Negative rates ($\widehat{FN}$). Three estimation methods: OLS, RBE and BAY. We have 6 *DGPs*  where $\beta \in \{0, 0.025, 0.05, 0.075, 0.1, 0.2\}$ and $b_0^R= 0.5$.

```{r table_7_show, results='asis'}

kable(results.final, digits = 2)

```


```{r table_7_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Table 8

```{r table_8_prepare, warning=FALSE, include=FALSE}

# We do not report OLS and RBE since they are the same as in Table 6
# We do not report results for non-fixed R^2 since the results are the same as in Table 6

results_1 <- fun.combine_results_v2(folder = "v11/dgp_1")
results_2 <- fun.combine_results_v2(folder = "v11/dgp_2")
results_3 <- fun.combine_results_v2(folder = "v11/dgp_3")
results_4 <- fun.combine_results_v2(folder = "v11/dgp_4")
results_5 <- fun.combine_results_v2(folder = "v11/dgp_5")
results_6 <- fun.combine_results_v2(folder = "v11/dgp_6")


results <- results_1$beta_all_methods %>% 
  bind_rows(results_2$beta_all_methods) %>% 
  bind_rows(results_3$beta_all_methods) %>% 
  bind_rows(results_4$beta_all_methods) %>% 
  bind_rows(results_5$beta_all_methods) %>% 
  bind_rows(results_6$beta_all_methods) %>% 
  mutate(SD   = 100 * sqrt(Var / 1000),
         RMSE = 100 * sqrt(MSE / 1000)) %>% 
  select(Method, 
         Bias,
         SD,
         MAE,
         RMSE,
         SAV_med) %>% 
  filter(Method == "BAY") %>% 
  mutate(across(is.numeric, ~round(.x, 2)))

Vars_in <- c(rep("0", 1),
             rep("0.025", 1),
             rep("0.05", 1),
             rep("0.075", 1),
             rep("0.1", 1),
             rep("0.2", 1)
)

results.final <- results %>% 
  mutate(beta = Vars_in)


```


Measures of the estimation quality for $\widehat{\beta}^{\bullet}$ (multiplied by 100): Bias $B(\widehat{\beta}^{\bullet}, \beta$), Sample standard deviation of the point estimates $\sigma(\widehat{\beta}^{\bullet})$, MAE($\widehat{\beta}^{\bullet}, \beta$), RMSE($\widehat{\beta}^{\bullet}, \beta$) estimated False Positive ($\widehat{FP}$) and estimated False Negative rates ($\widehat{FN}$). Three estimation methods: OLS, RBE and BAY. We have two priors on $R^2$. The first prior has a non-fixed $R^2$ by choosing $a_0^R \in \{0.1, 0.5\}$ and $b_0^R = 1$. The second has a fixed $R^2$ by choosing $(a_0^R, b_0^R) \in \{(0.1, 1.9), (1, 19)\}$.  We have 6 *DGPs*  where $\beta \in \{0, 0.025, 0.05, 0.075, 0.1, 0.2\}$.

```{r table_8_show, results='asis'}

kable(results.final, digits = 2)

```


```{r table_8_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Table 9

Please see the folder **supp** that contains the results for Table 9. We provide here the input data for EViews

```{r table_9_prepare, warning=FALSE, include=FALSE}

# Load data
data_load <- read_rds(paste0(path, "data/2.real_data/tbl.goyal_annual_v3.rds"))

# Data
tbl.data <- data_load %>% 
  filter(between(date, left  = as.Date("1926-01-01"), 
                 right = as.Date("2022-12-01"))) 


vars_in <- c("ep.sp", "b.m", "dg.sp", "dfy", "tms")

data_save <- tbl.data %>% 
  dplyr::select(date, vars_in)

```


## Table 10

```{r table_10_prepare, warning=FALSE, include=FALSE}

# Take necessary names
names_files <- list.files(paste0(path, "data/2.real_data/res/"))

# Save names
names_in <- sapply(names_files, function(x) strsplit(x, split = "[.]")[[1]][3])

# Object to save
res_all <- list()

# Save
for(i in 1:length(names_files)){
  
  res_all[[i]] <- read_rds(paste0(path, "data/2.real_data/res/", names_files[i]))
  
  print(i)
  
}

tbl_final <- fun.effective_summary_table(res_all, names_in = names_in)

# Vars order
order_in <- c("dp_crsp_1", "dp_crsp_2", "bm", "dfy", "dg_sp", "ep_sp", "tms")

tbl_final_eff <- tbl_final[1:7,] %>%
  rename(Var = Sample) %>% 
  mutate(Var =  factor(Var, levels = order_in)) %>%
  arrange(Var) %>% 
  dplyr::select(-Length)

tbl_final_conv <- tbl_final[8:14,] %>%
  rename(Var = Sample) %>% 
  mutate(Var =  factor(Var, levels = order_in)) %>%
  arrange(Var) %>% 
  dplyr::select(-Length)
  

```

Effective Sample Size and Z-Scores for the parameters: $\psi, \phi$ and $\beta$ for the log *Dividend-Price Ratio* for *Sample 1* and *Sample 2* and for *Book-to-Market Ratio*, the log *Earnings-Price Ratio*, the *Default Yield Spread*, log *Dividend-Growth*, and the *Term Spread*. The number of thinned posterior draws $M = 30,001$.


```{r table_10_eff_show, results='asis'}

kable(tbl_final_eff, digits = 0)

```

```{r table_10_conv_show, results='asis'}

kable(tbl_final_conv, digits = 3)

```


```{r table_10_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
#knitr::knit_exit()
```


## Figure 1

```{r figure_1_prepare, warning=FALSE, include=FALSE}

results       <- fun.combine_results(folder = "v4")
results_dgp_1 <- read_rds(paste0(path, "data/1.sim_data/v4/dgp_1/res.5.8.1-3.1.rds"))
results_dgp_2 <- read_rds(paste0(path, "data/1.sim_data/v4/dgp_2/res.5.8.1-3.2.rds"))

plot.beta_1 <- fun.plot.sim_data.beta(date_in   = results$data.beta_1, 
                                      DGP       = 0,
                                      index_bay = results_dgp_1$index_bay)
plot.beta_2 <- fun.plot.sim_data.beta(date_in   = results$data.beta_2, 
                                      DGP       = 0,
                                      index_bay = results_dgp_2$index_bay)

plot.beta <- ggarrange(plot.beta_1,
                       plot.beta_2,
                       ncol = 2, 
                       nrow = 1, 
                       common.legend = TRUE, 
                       legend="bottom")

```

Sampling distributions of the point estimator $\widehat{\beta}^{\bullet}$ for the Bayesian estimator (red) and for the frequentist estimators OLS (green) and RBE (blue). The left panel is the result for *DGP 0* and the right panel is the result for *DGP 1*.

```{r figure_1_show, fig.width=15, fig.height=6}

plot.beta

```


```{r figure_1_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```



## Figure 2

```{r figure_2_prepare, warning=FALSE, include=FALSE}

results       <- fun.combine_results(folder = "v4")
results_dgp_1 <- read_rds(paste0(path, "data/1.sim_data/v4/dgp_1/res.5.8.1-3.1.rds"))
results_dgp_2 <- read_rds(paste0(path, "data/1.sim_data/v4/dgp_2/res.5.8.1-3.2.rds"))

a_R_1 <- results$data.a_R_1$BAY_5_8
a_R_1[results_dgp_1$index_bay] <- NA_real_

a_R_2 <- results$data.a_R_2$BAY_5_8
a_R_2[results_dgp_2$index_bay] <- NA_real_

tbl.gen.hist <- tibble('DGP 0' = a_R_1,
                       'DGP 1' = a_R_2)

tbl.gen.hist <- tbl.gen.hist %>% 
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Value") %>% 
  mutate(Variable = as.factor(Variable))

plot.a_R <- ggplot(tbl.gen.hist, aes(x = Value, fill = Variable)) + 
  xlim(0.1, 0.5) +
  geom_density(alpha = 0.3) + 
  xlab(expression(widehat(a[0]^R))) +
  ylab("Density") + 
  geom_point(x = 0.1, y = 0, show.legend = F, shape = 21, colour = "black", fill = "white", size = 3, stroke = 3) + 
  geom_point(x = 0.5, y = 0, show.legend = F, shape = 21, colour = "black", fill = "white", size = 3, stroke = 3) +
  geom_point(x = mean(a_R_1, na.rm = T), y = 0, shape = 21, colour = "black", fill = "red", size = 3, stroke = 3) + 
  geom_point(x = mean(a_R_2, na.rm = T), y = 0, shape = 21, colour = "black", fill = "blue", size = 3, stroke = 3) +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))

```

Sampling distribution of the posterior mean $\widehat{a}_0^R$ based on posterior means $\widehat{a}_{0,i}^R$, $i=1,\dots,n_d$ obtained from the thinned draws $(a_0^R)_i^{(m)}$, $m=1,\dots,2\,000$, for the Bayesian estimator for *DGP 0* (red) and for *DGP 1* (blue). White dots represent the prior values for $a_0^R$ with $\underline{a}_0^{R} = 0.1$,  $\bar{a}_0^{R} = 0.5$ and two filled dots represent the average of the posterior means $\widehat{a}_{0,i}^R$ for *DGP 0* (red) and for *DGP 1* (blue).

```{r figure_2_show, warning=FALSE, fig.width=15, fig.height=6}

plot.a_R

```


```{r figure_2_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Figure 3

```{r figure_3_prepare, warning=FALSE, include=FALSE}

load(paste0(path, "data/1.sim_data/v9/res_main.RData"))

p1 <- fun.plot_aggregated_density_beta(var_in   = beta_1[-index_1], 
                                       left_in  = -0.1, 
                                       right_in = 0.1, 
                                       y_lim_in = 15, 
                                       title_in = "DGP 0")


p2 <- fun.plot_aggregated_density_beta(var_in   = beta_2[-index_2], 
                                       left_in  = -0.1, 
                                       right_in = 0.3, 
                                       y_lim_in = 15, 
                                       title_in = "DGP 1")


p.all <- ggarrange(p1, p2, ncol = 2, nrow = 1, common.legend = TRUE, legend="bottom")

```

5/50/95\% quantiles (dashed lines) of the estimated marginal posterior distributions $\widehat{p}\left({\beta}|\mathbb{D}_{T,i} \right)$ by the kernel density estimator implemented in **R**, using default bandwidth choice using the thinned draws $\beta^{(m)}_i$, $m=1,\dots,2\,000$ for $i=1,\dots,n_d$. The solid red line shows the prior density. The left panel is the result for *DGP 0* and the right panel is the result for *DGP 1*.

```{r figure_3_show, fig.width=15, fig.height=6}

p.all

```


```{r figure_3_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Figure 4 and 5

```{r figure_4_5_prepare, warning=FALSE, include=FALSE}

names_in   <- c("dp.crsp", "ep.sp", "b.m", "dg.sp", "dfy","tms")
names_plot <- c("DP", "EP", "BM", "DG", "DFY", "TMS")


plot.exp <- list()
plot.rol <- list()

for(i in 1:length(names_in)){
  
  tbl.errors.rol <- read_rds(paste0(path, "data/2.real_data/oos/",names_in[i],"/tbl.errors.rol.rds"))
  
  tbl.errors.exp <- read_rds(paste0(path, "data/2.real_data/oos/",names_in[i],"/tbl.errors.exp.rds"))
  
  tbl.dates <- seq(from = as.Date("1926-01-01"),
                   to   = as.Date("2021-01-01"),
                   by   = "year")[42:96]
  
  # Rolling
  colnames(tbl.errors.rol) <- c("i", "ret_fut", "err_bay", "err_rbe", "err_ols", "err_mean")
  
  tbl.errors <- as_tibble(tbl.errors.rol)
  
  tbl.errors.rol <- tbl.errors.rol %>% 
    bind_cols(dates = tbl.dates)
  
  # Expanding
  colnames(tbl.errors.exp) <- c("i", "ret_fut", "err_bay", "err_rbe", "err_ols", "err_mean")
  
  tbl.errors <- as_tibble(tbl.errors.exp)
  
  tbl.errors.exp <- tbl.errors.exp %>% 
    bind_cols(dates = tbl.dates)
  
  
  plot.exp[[i]] <- fun.real_data_csse(data_in = tbl.errors.exp, 
                                      name_y  = names_plot[i])
  
  plot.rol[[i]] <- fun.real_data_csse(data_in = tbl.errors.rol, 
                                      name_y  = names_plot[i])
  
  
}

plot.all.exp <- ggarrange(plotlist = plot.exp, ncol = 2, nrow = 3, common.legend = TRUE, legend="bottom")
plot.all.rol <- ggarrange(plotlist = plot.rol, ncol = 2, nrow = 3, common.legend = TRUE, legend="bottom")

```

Time series plot for $\Delta\text{CSSE}_{t}^{\bullet}$ for Bayesian, OLS and RBE estimation based on the *expanding* window approach that starts in 1966 and ends in 2020. Log Dividend-Price Ratio (DP), Book-to-Market Ratio (BM), log Earnings-Price Ratio (EP), log Dividend-Growth (DG), Default Yield Spread (DFY) and Term Spread (TMS).

```{r figure_4_5_exp_show, fig.width=15, fig.height=18}

plot.all.exp

```

Time series plot for $\Delta\text{CSSE}_{t}^{\bullet}$ for Bayesian, OLS and RBE estimation based on the *rolling* window approach with window size 40 years that starts in 1966 and ends in 2020. Log Dividend-Price Ratio (DP), Book-to-Market Ratio (BM), log Earnings-Price Ratio (EP), log Dividend-Growth (DG), Default Yield Spread (DFY) and Term Spread (TMS).

```{r figure_4_5_rol_show, fig.width=15, fig.height=18}

plot.all.rol

```


```{r figure_4_5_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```


## Figure 6

```{r figure_6_prepare, warning=FALSE, include=FALSE}

T_len <- 1e4

Prior_R2_all <- list(
  list(a_R = 0.5, b_R = 1),
  list(a_R = 0.1, b_R = 1),
  list(a_R = sample(x = c(0.1, 0.5), size = T_len, replace = T),
       b_R = 1)
)

# Simulate priors
prior.r2     <- sapply(Prior_R2_all, function(x) density(rbeta(n      = T_len, 
                                                               shape1 = x$a_R,
                                                               shape2 = x$b_R), 
                                                         from = 0, 
                                                         to   = 0.2, 
                                                         n    = 1e4)$y)
prior.r2 <- tibble(x = seq(from = 0, to = 0.2, length = 1e4),
                   unif = 1,
                   as_tibble(prior.r2))

colnames(prior.r2) <- c("x", paste0("Prior_", 1:4))


prior.r2 <- pivot_longer(data      = prior.r2, 
                         cols      = Prior_1:Prior_4, 
                         names_to  = "Variable", 
                         values_to = "Value")

labels_in <- list(expression(paste(a[0]^R == 1)),
                  expression(paste(a[0]^R == 0.5)),
                  expression(paste(a[0]^R == 0.1)),
                  expression(paste(a[0]^R, " random")))


p1 <- ggplot(data = prior.r2, aes(x = x, y = Value)) +
  geom_line(aes(color = Variable)) + 
  scale_color_hue(labels = labels_in) +
  coord_cartesian(xlim = c(0, 0.2),
                  ylim = c(0, 15)) +
  xlab(expression(R^2)) +
  ylab("Density") +
  theme(text = element_text(size = 30)) +
  theme(legend.key.size = unit(1, 'cm'))

```

Priors on $R^2$. The prior on $R^2$ is defined in Equation (30) with different values for $a_0^{R}$ and $b_0^{R}$ being fixed to one. The first prior (red) is a flat prior with $a_0^{R} = 1$ and $b_0^{R} = 1$. The second prior (green) has $a_0^{R} = 0.5$ and $b_0^{R} = 1$. The third prior (cyan) has $a_0^{R} = 0.1$ and $b_0^{R} = 1$. The fourth prior (purple) has a hyperprior on $a_0^{R}$ with $a_0^{R} = \bar{a}_0^{R} = 0.5$ with probability $p_{a_0^{R}} = 0.5$ and $a_0^{R} = \underline{a}_0^{R} = 0.1$ with probability $1-p_{a_0^{R}} = 0.5$ discussed in Section 3.1

```{r figure_6_show, fig.width=15, fig.height=6}

p1

```


```{r figure_6_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Figure 7

```{r figure_7_prepare, warning=FALSE, include=FALSE}

T_len <- 1e5

dgp_0 <- rnorm(n = T_len, mean = 2, sd = 0.5)
dgp_1 <- rnorm(n = T_len, mean = 0, sd = 0.5)


dens_0  <- density(dgp_0, from = 0, na.rm = T)
dens_1  <- density(dgp_1, from = 0, na.rm = T)

data_0  <- tibble(x = dens_0$x, y = dens_0$y, Variable = "DGP 0") %>% 
  mutate(variable = case_when(
    (x <= 1) ~ "Error_0",
    TRUE ~ "Okay"))

data_1  <- tibble(x = dens_1$x, y = dens_1$y, Variable = "DGP 1") %>% 
  mutate(variable = case_when(
    (x >= 1) ~ "Error_1",
    TRUE ~ "Okay"))


data_all <- bind_rows(data_0, data_1)

# Plot
p1 <- ggplot(data_all, aes(x = x, y = y, col = Variable)) + geom_line() +
  geom_area(data = filter(data_all, variable == 'Error_0'), fill = 'red', alpha = 0.1, show.legend = F) +
  geom_area(data = filter(data_all, variable == 'Error_0_small'), fill = 'red', alpha = 0.1, show.legend = F) +
  geom_area(data = filter(data_all, variable == 'Error_1'), fill = 'blue', alpha = 0.1, show.legend = F) +
  geom_vline(xintercept = 1) +
  xlim(0, 2) + 
  xlab("Bayes Factor") + 
  ylab("Density") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))


```

Hypothetical distribution of the Bayes Factors under *DGP 0* (red line) and *DGP 1* (blue line). The vertical line indicates the testing threshold ${K} = 1$. The red area represents the size of the test and the blue area represents the power of the test.

```{r figure_7_show, warning=FALSE, fig.width=15, fig.height=6}

p1

```


```{r figure_7_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Figure 8

```{r figure_8_prepare, warning=FALSE, include=FALSE}

# Save the results
results       <- fun.combine_results(folder = "v4")
results_dgp_1 <- read_rds(paste0(path, "data/1.sim_data/v4/dgp_1/res.5.8.1-3.1.rds"))
results_dgp_2 <- read_rds(paste0(path, "data/1.sim_data/v4/dgp_2/res.5.8.1-3.2.rds"))

res.bay <- fun.sim_data_plot_BF(data_in      = results, 
                                Prior_type   = "BAY_5_8",
                                index_bay_1  = results_dgp_1$index_bay,
                                index_bay_2  = results_dgp_2$index_bay,
                                k            = 1)

res.ols <- fun.sim_data_plot_BF(data_in    = results, 
                                Prior_type = "OLS", 
                                k          = 1.96)

res.rbe <- fun.sim_data_plot_BF(data_in    = results, 
                                Prior_type = "RBE", 
                                k          = 1.96)


fig.BF <- ggarrange(res.bay,
                    ggarrange(res.ols, res.rbe, ncol = 2, nrow = 1, common.legend = FALSE, legend=FALSE), ncol = 1, nrow = 2, common.legend = TRUE, legend="bottom")


```

Sampling distribution of the Bayes Factor for the parameter ${\beta}$ for the Bayesian estimator (upper panel) and sampling distribution for the $t$-values for the frequentist estimators OLS (lower left panel) and RBE (lower right panel). The left panel is the result for *DGP 0* and the right panel is the result for *DGP 1*.

```{r figure_8_show, fig.width=15, fig.height=12}

fig.BF

```


```{r figure_8_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Figure 9

```{r figure_9_prepare, warning=FALSE, include=FALSE}

load(paste0(path, "data/1.sim_data/v9/res.a_R_prior_spec.beta_0.1.T_len_1000.RData"))

beta_1    <- beta
index_1   <- index_bay

load(paste0(path, "data/1.sim_data/v9/res.a_R_prior_spec.beta_0.15.T_len_500.RData"))

beta_2    <- beta
index_2   <- index_bay

load(paste0(path, "data/1.sim_data/v9/res.a_R_prior_spec.beta_0.2.T_len_100.RData"))

beta_3    <- beta
index_3   <- index_bay

p1 <- fun.plot_aggregated_density_beta(var_in   = beta_1[-index_1], 
                                       left_in  = -0.1, 
                                       right_in = 0.3, 
                                       y_lim_in = 30, 
                                       title_in = expression(paste(beta == 0.1, " and ", T == 1000)))

p2 <- fun.plot_aggregated_density_beta(var_in   = beta_2[-index_2], 
                                       left_in  = -0.1, 
                                       right_in = 0.3, 
                                       y_lim_in = 20, 
                                       title_in = expression(paste(beta == 0.15, " and ", T == 500)))

p3 <- fun.plot_aggregated_density_beta(var_in   = beta_3[-index_3], 
                                       left_in  = -0.1, 
                                       right_in = 0.3, 
                                       y_lim_in = 10, 
                                       title_in = expression(paste(beta == 0.2, " and ", T == 100)))

p.all <- ggarrange(p1, p2, p3, ncol = 1, nrow = 3, common.legend = TRUE, legend="bottom")


```

5/50/95\% quantiles (dashed lines) of the estimated marginal posterior distributions $\widehat{p}\left({\beta}|\mathbb{D}_{T,i} \right)$ by the kernel density estimator implemented in **R**, using default bandwidth choice using the thinned draws $\beta^{(m)}_i$, $m=1,\dots,2\,000$ for $i=1,\dots,n_d$. The top panel is the result for $\beta = 0.1$ and $T = 1\,000$. The middle panel is the result for $\beta = 0.15$ and $T = 5\,000$. The bottom panel is the result for $\beta = 0.2$ and $T = 100$.

```{r figure_9_show, fig.width=15, fig.height=18}

p.all

```


```{r figure_9_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Figure 10 and 11

```{r figure_10_11_prepare, warning=FALSE, include=FALSE}

data_load <- read_rds(paste0(path, "data/2.real_data/tbl.goyal_annual_v3.rds"))

# Data
tbl.data.1 <- data_load %>% 
  filter(between(date, left  = as.Date("1926-01-01"), 
                       right = as.Date("2004-01-01"))) 

tbl.data.2 <- data_load %>% 
  filter(between(date, left  = as.Date("1953-01-01"), 
                       right = as.Date("2022-12-01"))) 


p1 <- ggAcf(tbl.data.1$ret.crsp.l, lag.max = 30, main = "Sample 1") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p2 <- ggAcf(tbl.data.2$ret.crsp.l, lag.max = 30, main = "Sample 2") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p3 <- ggPacf(tbl.data.1$ret.crsp.l, lag.max = 30, main = "Sample 1") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p4 <- ggPacf(tbl.data.2$ret.crsp.l, lag.max = 30, main = "Sample 2") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))

p.all_ret <- ggarrange(p1, p3, p2 , p4, ncol = 2, nrow = 2, common.legend = TRUE, legend="bottom")

p1 <- ggAcf(tbl.data.1$dp.crsp, lag.max = 30, main = "Sample 1") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p2 <- ggAcf(tbl.data.2$dp.crsp, lag.max = 30, main = "Sample 2") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p3 <- ggPacf(tbl.data.1$dp.crsp, lag.max = 30, main = "Sample 1") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p4 <- ggPacf(tbl.data.2$dp.crsp, lag.max = 30, main = "Sample 2") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))

p.all_dp <- ggarrange(p1, p3, p2 , p4, ncol = 2, nrow = 2, common.legend = TRUE, legend="bottom")


```

ACF and PACF plots for log returns $y_t$. The upper panel is the result for *Sample 1* and the lower panel is the result for *Sample 2*. The left panel is the ACF plot and the right panel is the PACF plot. The dotted lines show 95\% confidence bands.

```{r figure_10_11_ret_show, fig.width=15, fig.height=12}

p.all_ret

```

ACF and PACF plots for log dividend-price ratio $x_t$. The upper panel is the result for *Sample 1* and the lower panel is the result for *Sample 2* The left panel is the ACF plot and the right panel is the PACF plot. The dotted lines show 95\% confidence bands.

```{r figure_10_11_dp_show, fig.width=15, fig.height=12}

p.all_dp

```


```{r figure_10_11_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```


## Figure 12 and 13

```{r figure_12_13_prepare, warning=FALSE, include=FALSE}

data_load <- read_rds(paste0(path, "data/2.real_data/tbl.goyal_annual_v3.rds"))

# Data
tbl.data <- data_load %>% 
  filter(between(date, left  = as.Date("1926-01-01"), 
                       right = as.Date("2022-12-01"))) 


vars_in <- c("ep.sp", "b.m", "dg.sp", "dfy", "tms")

data_save <- tbl.data %>% 
  dplyr::select(date, vars_in)


## EP ##
p.acf.ep <- ggAcf(tbl.data$ep.sp, lag.max = 30, main = "EP") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p.pacf.ep <- ggPacf(tbl.data$ep.sp, lag.max = 30, main = "EP") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))

## BM ##
p.acf.bm <- ggAcf(tbl.data$b.m, lag.max = 30, main = "BM") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p.pacf.bm <- ggPacf(tbl.data$b.m, lag.max = 30, main = "BM") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))

## DG ##
p.acf.dg <- ggAcf(tbl.data$dg.sp, lag.max = 30, main = "DG") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p.pacf.dg <- ggPacf(tbl.data$dg.sp, lag.max = 30, main = "DG") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))

## DFY ##
p.acf.dfy <- ggAcf(tbl.data$dfy, lag.max = 30, main = "DFY") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p.pacf.dfy <- ggPacf(tbl.data$dfy, lag.max = 30, main = "DFY") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))

## TMS ##
p.acf.tms <- ggAcf(tbl.data$tms, lag.max = 30, main = "TMS") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))
p.pacf.tms <- ggPacf(tbl.data$tms, lag.max = 30, main = "TMS") +
  theme(text = element_text(size = 20)) +
  theme(legend.key.size = unit(1, 'cm'))

p.all.1 <- ggarrange(p.acf.ep, p.pacf.ep,
                     p.acf.bm, p.pacf.bm,
                     p.acf.dfy, p.pacf.dfy,
                     ncol = 2, nrow = 3, common.legend = TRUE, legend="bottom")

p.all.2 <- ggarrange(p.acf.dg, p.pacf.dg,
                     p.acf.tms, p.pacf.tms,
                     ncol = 2, nrow = 2, common.legend = TRUE, legend="bottom")

```

ACF and PACF plots for log *Earnings-Price Ratio*  (upper panel), *Book-to-Market Ratio* (middle panel) and *Default Yield Spread* (lower panel). The left panel is the ACF plot and the right panel is the PACF plot. The dotted lines show 95\% confidence bands.

```{r figure_12_13_part1_show, fig.width=15, fig.height=18}

p.all.1


```

ACF and PACF plots for the log *Dividend-Growth*  (upper panel) and the *Term Spread* (lower panel) The left panel is the ACF plot and the right panel is the PACF plot. The dotted lines show 95\% confidence bands.

```{r figure_12_13_part2_show, fig.width=15, fig.height=12}

p.all.2

```

```{r figure_12_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```



## Figure 14

```{r figure_14_prepare, warning=FALSE, include=FALSE}

res_1 <- read_rds(paste0(path, "data/2.real_data/res/res.real_data.dp_crsp_1.rds")) 
res_2 <- read_rds(paste0(path, "data/2.real_data/res/res.real_data.dp_crsp_2.rds")) 


p1 <- fun.real_data_plot_beta(data_in   = res_1, 
                              plot_name = "Sample 1", 
                              name_x    = expression(beta), 
                              y_lim     = 13)

p2 <- fun.real_data_plot_beta(data_in   = res_2, 
                              plot_name = "Sample 2", 
                              name_x    = expression(beta), 
                              y_lim     = 13)

p.all <- ggarrange(p1, p2, ncol = 2, nrow = 1, common.legend = TRUE, legend="bottom")


```

Prior and posterior densities for $\beta$ and point estimates for BAY, OLS and RBE. The solid line is the prior distribution and the dashed line with the filed area stands for the posterior distribution. The empty triangle is the prior mean that equals zero and the filled triangle is the estimated mean of the posterior distribution $\widehat{\beta}^{BAY}$, the empty square is the OLS estimator $\widehat{\beta}^{OLS}$
and the empty circle is the RBE estimator $\widehat{\beta}^{RBE}$. The left panel describes the result for *Sample 1*, whereas the right panel describes the result for *Sample 2*.

```{r figure_14_show, fig.width=15, fig.height=6}

p.all

```


```{r figure_14_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

## Figure 15

```{r figure_15_prepare, warning=FALSE, include=FALSE}

res_1 <- read_rds(paste0(path, "data/2.real_data/res/res.real_data.dp_crsp_1.rds")) 
res_2 <- read_rds(paste0(path, "data/2.real_data/res/res.real_data.dp_crsp_2.rds")) 


traceplot.all <- ggarrange(
  fun.real_data_traceplot(value_in = res_1$beta, name_y = expression(beta)),
  fun.real_data_traceplot(value_in = res_2$beta , name_y = expression(beta)),
  
  fun.real_data_traceplot(value_in = res_1$phi , name_y = expression(phi)),
  fun.real_data_traceplot(value_in = res_2$phi , name_y = expression(phi)),
  
  fun.real_data_traceplot(value_in = res_1$psi , name_y = expression(psi)),
  fun.real_data_traceplot(value_in = res_2$psi , name_y = expression(psi)),
  ncol = 2, nrow = 3, common.legend = TRUE, legend="bottom")

```

Traceplots for the parameters $\psi, \phi$ and $\beta$. The left panel is for DP *Sample 1* and the right panel is for DP *Sample 2*

```{r figure_15_show, fig.width=15, fig.height=18}

traceplot.all

```


```{r figure_15_delete, warning=FALSE, include=FALSE}
#rm(list = ls())
```

